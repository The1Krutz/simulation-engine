<!doctype html>
<html>

<head>
    <title>Socket.IO chat</title>
    <meta charset="utf-8">
    <script src="/socket.io/socket.io.js"></script>
    <script src="static/two.js"></script>
</head>

<body>
    <div id="draw-shapes"></div>
    <script>
        // drawing stuff
        const elem = document.getElementById('draw-shapes');
        const params = { width: 500, height: 500 };
        const two = new Two(params).appendTo(elem);

        const border = two.makeRectangle(250, 250, 500, 500);
        border.stroke = 'black';
        border.linewidth = 3;

        const circles = {};

        // socket stuff
        const socket = io();
        socket.on('update', (movers, moverstring) => {
            movers.forEach(mover => {
                if (circles[mover.id]) {
                    // console.log('moving existing circle', mover.id)
                    circles[mover.id].translation.set(mover.position.x, mover.position.y);
                } else {
                    // console.log('creating new circle', mover.id)
                    circles[mover.id] = two.makeCircle(mover.position.x, mover.position.y, 5);
                    circles[mover.id].fill = mover.color;
                }
            });

            two.update();
        });

        socket.on('remove', id => {
            // console.log('explicitly removing', id)
            two.remove(circles[id]);
            circles[id] = undefined;
        });
    </script>
</body>

</html>